var q=Object.defineProperty;var L=(s,e,t)=>e in s?q(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>L(s,typeof e!="symbol"?e+"":e,t);import{P as y,N as x,S as m,M as b}from"./vendor2.js";class P{constructor(e){this.element=e,this.elementSection=e.closest("section"),this.navigation={prev:this.elementSection.querySelector(".js-slider-default-navigation-prev"),next:this.elementSection.querySelector(".js-slider-default-navigation-next")},this.paginationBullet=this.elementSection.querySelector(".js-slider-default-pagination-bullet"),this.paginationIndex=this.elementSection.querySelector(".js-slider-default-pagination-index"),this.parametersSwiper={slidesPerView:"auto",modules:[]},this.parametersSwiperExtra=this.element.getAttribute("data-parameter"),this.parametersSwiperExtra&&(this.parametersSwiper={...this.parametersSwiper,...JSON.parse(this.parametersSwiperExtra)}),window.innerWidth<581&&(this.parametersSwiper.loop=!1,this.parametersSwiper.centeredSlides=!1),this.init()}setPaginationBullet(){this.parametersSwiper.modules.push(y),this.parametersSwiper.pagination={el:this.paginationBullet,bulletClass:"slider-pagination__bullet-item",bulletActiveClass:"slider-pagination__bullet-item_active"}}setNavigation(){this.parametersSwiper.modules.push(x),this.parametersSwiper.navigation={prevEl:this.navigation.prev,nextEl:this.navigation.next}}getPaginationIndex(e){const t=this.parametersSwiper.loop?e.realIndex+1:e.snapIndex+1,i=e.pagination.bullets.length;return`${(t<10?"0":"")+t} / ${(e.pagination.bullets.length<10?"0":"")+i}`}setPaginationIndex(e){this.paginationIndex.innerText=this.getPaginationIndex(e),e.on("beforeTransitionStart resize",()=>{this.paginationIndex.innerText=this.getPaginationIndex(e)})}init(){this.paginationBullet&&this.setPaginationBullet(),this.navigation.prev&&this.navigation.next&&this.setNavigation(),this.slider=new m(this.element,this.parametersSwiper),this.paginationIndex&&this.paginationBullet&&this.setPaginationIndex(this.slider)}}class A{constructor(e){this.container=e,this.preview=this.container.querySelector(".js-event-preview"),this.items=this.container.querySelectorAll(".js-event-item"),this.init()}getCoord(e){return{y:e.pageY-this.container.offsetTop-this.preview.offsetWidth}}setEventCoordPreview(){this.container.addEventListener("mousemove",e=>{this.preview.style.opacity=1,this.preview.style.top=`${this.getCoord(e).y}px`,this.preview.style.left=`${this.getCoord(e).x}px`}),this.container.addEventListener("mouseleave",()=>{this.preview.style.opacity=0})}setEventChangeImage(){this.items.forEach(e=>{e.addEventListener("mouseenter",()=>{let t=e.querySelector(".js-event-item-image").getAttribute("src");this.preview.querySelector(".js-event-preview-img").setAttribute("src",t)})})}init(){this.container&&this.preview&&(this.container.style.position="relative",this.container.style.zIndex=3,this.setEventCoordPreview()),this.preview&&(this.preview.insertAdjacentHTML("afterbegin",'<img src="#" class="js-event-preview-img object-fit-cover">'),this.preview.image=this.preview.querySelector(".js-event-preview-img"),this.setEventChangeImage())}}class I{constructor(e){this.element=e,this.text=this.element.innerText,this.lengthDesktop=this.element.getAttribute("data-length"),this.lengthMobile=this.element.getAttribute("data-length-mobile"),this.init()}getLengthText(e,t){return{mobile:this.text.length>=t?`${this.text.substring(0,t)}...`:!1,desktop:this.text.length>=e?`${this.text.substring(0,e)}...`:!1}}setNewText(){const e=this.getLengthText(this.lengthDesktop,this.lengthMobile);window.innerWidth>580&&e.desktop?this.element.innerText=e.desktop:e.mobile&&(this.element.innerText=e.mobile)}init(){this.setNewText(),window.addEventListener("resize",()=>{this.setNewText()})}}function p(s,e){s.setAttribute("src",e)}class T{constructor(e){this.section=e,this.mainSliderElements={slider:e.querySelector(".js-products-slider-main"),paginations:e.querySelectorAll(".js-products-slider-main-tabs-pagination")},this.innerSlidersElements=e.querySelectorAll(".js-products-slider-inner"),this.mainSlider={},this.innerSlider={},this.defaultParameterSwiper={slidesPerView:1,slideActiveClass:"is-active"},this.init()}setTabsPagination(e,t,i=!1){const n=t.querySelectorAll(".js-products-slider-tabs-pagination-button");function a(o){t.querySelector(".is-active").classList.remove("is-active"),n[o].classList.add("is-active")}if(n.forEach((o,r)=>{r===0&&i&&o.classList.add("is-active"),o.addEventListener("click",l=>{l.preventDefault(),e.activeIndex!==r&&e.slideTo(r)})}),i)return a}setIndexPagination(e,t){const i=e.snapIndex+1,n=e.pagination.bullets.length;t.innerText=`${(i<10?"0":"")+i} / ${(e.pagination.bullets.length<10?"0":"")+n}`}initMainSlider(){this.mainSlider=new m(this.mainSliderElements.slider,{...this.defaultParameterSwiper,direction:"vertical",speed:500,allowTouchMove:!1,autoHeight:!0}),this.mainSliderElements.paginations.length&&this.mainSliderElements.paginations.forEach(e=>{this.setTabsPagination(this.mainSlider,e)})}initInnerSlider(e,t){const i=e.closest(".swiper-slide"),n=i.querySelector(".js-products-slider-inner-tabs-pagination"),a=i.querySelector(".js-slider-default-pagination-index"),o=i.querySelector(".js-slider-default-pagination-bullet"),r={prev:i.querySelector(".js-slider-default-navigation-prev"),next:i.querySelector(".js-slider-default-navigation-next")},l={...this.defaultParameterSwiper,slidesPerView:"auto",modules:[y,x]};o&&(l.pagination={el:o,bulletClass:"slider-pagination__bullet-item",bulletActiveClass:"slider-pagination__bullet-item_active"}),r.prev&&r.next&&(l.navigation={prevEl:r.prev,nextEl:r.next}),this.innerSlider[t]=new m(e,l),a&&o&&this.setIndexPagination(this.innerSlider[t],a);const j=this.setTabsPagination(this.innerSlider[t],n,!0);this.innerSlider[t].on("transitionStart",c=>{if(n&&j(c.activeIndex),a&&o&&this.setIndexPagination(c,a),window.innerWidth>1120){const g=c.el.closest(".js-products-slider-main-slide").querySelector(".js-scheme"),E=c.slides[c.snapIndex].querySelector(".js-item-product").getAttribute("data-scheme");g&&p(g,E)}})}init(){this.mainSliderElements.slider&&this.initMainSlider(),this.innerSlidersElements.length&&this.innerSlidersElements.forEach((e,t)=>{this.initInnerSlider(e,t)})}}const h=document.querySelector(".js-modal-menu"),f=document.querySelector(".js-button-burger"),v=document.querySelector(".js-part-header");h&&(new b(h,{backdrop:!1}),h.addEventListener("show.bs.modal",()=>{window.scrollTo(0,0),v.style.zIndex=1e3,f.classList.add("is-active")}),h.addEventListener("hide.bs.modal",()=>{v.style.zIndex="auto",f.classList.remove("is-active")}));const S=document.querySelectorAll(".js-form-field");S.length&&S.forEach(s=>{const e=s.querySelector(".js-form-field-clear"),t=s.querySelector(".js-form-field-input");e&&e.addEventListener("click",()=>{t.value="",s.classList.contains("is-error")&&s.classList.remove("is-error")})});const w=document.querySelectorAll(".js-item-product");if(w.length){const s=new b("#modal-product");w.forEach(e=>{let t=e.getAttribute("data-event").split(","),i={event:{hover:t.includes("hover"),click:t.includes("click")},title:e.getAttribute("data-title"),floor:e.getAttribute("data-floor"),scheme:e.getAttribute("data-scheme")};i.event.hover&&e.addEventListener("mouseenter",()=>{if(window.innerWidth>580){console.log(1);let n=document.querySelector(".js-scheme-main");n&&p(n,i.scheme)}}),i.event.click&&e.addEventListener("click",n=>{window.innerWidth<580&&(n.preventDefault(),s._element.querySelector(".js-modal-product-title").innerText=i.title,s._element.querySelector(".js-modal-product-floor").innerText=i.floor,p(s._element.querySelector(".js-scheme"),i.scheme),s.show())})})}const u=document.querySelector(".js-fixed-element-section");if(u){const s=u.querySelector(".js-fixed-element");window.addEventListener("scroll",e=>{let t=u.getBoundingClientRect().top;t-window.innerHeight+u.offsetHeight<0||t>0?s.style.opacity=0:s.style.opacity=1})}class _{constructor(e){d(this,"isLoading",!1);d(this,"isDone",!1);d(this,"methods",{getMore:async()=>{this.page++,await this.methods.update()},toggleMoreVisibility:e=>{const{more:t}=this.refs;Number(e)<=this.page?(this.isDone=!0,t&&t.classList.add("display-none")):(this.isDone=!1,t&&t.classList.remove("display-none"))},update:async()=>{const{total_pages:e,list:t}=await this.methods.fetchData();this.methods.appendElements(t),this.methods.toggleMoreVisibility(e)},fetchData:async()=>{const e=new FormData(this.container),t=this.container.getAttribute("action");try{return await(await fetch(t,{method:"POST",body:e})).json()}catch(i){alert("Возникла ошибка: "+i.message)}},appendElements:e=>{if(!e)return!1;const{body:t}=this.refs;e.forEach(i=>{t.insertAdjacentHTML("beforeend",i)})},scrollHandler:async e=>{if(this.isLoading||this.isDone)return!1;const t=this.container.getBoundingClientRect(),n=t.top+window.scrollY+t.height,a=window.pageYOffset,o=n-n/4;a>o&&(console.log("fetch scrollHandler"),this.isLoading=!0,await this.methods.getMore(),this.isLoading=!1)},clickHandler:async e=>{if(e.preventDefault(),this.isLoading)return!1;this.isLoading=!0,this.methods.getMore(),this.isLoading=!1}});d(this,"listeners",{scrollLoad:()=>{const{scroll:e}=this.container.dataset;if(!e)return!1;window.addEventListener("scroll",()=>{this.methods.scrollHandler()})},moreClick:()=>{const{more:e}=this.refs;if(!e)return!1;e.addEventListener("click",this.methods.clickHandler)}});this.container=e,this.selectors={more:".js-listing-more",body:".js-listing-body",inputPage:"input[name='page']"},console.log("innit scroll more"),this._refs=null,Object.keys(this.listeners).forEach(t=>{this.listeners[t]()})}get refs(){if(!this._refs){this._refs={};for(const e in this.selectors){const t=this.selectors[e];this._refs[e]=this.container.querySelector(t)}}return this._refs}get page(){const{inputPage:e}=this.refs;return e!=null&&e.value?Number(e.value):1}set page(e){const{inputPage:t}=this.refs;t.value=e}}window.addEventListener("DOMContentLoaded",()=>{const s=document.querySelectorAll(".js-slider-default");s.length&&s.forEach(r=>{new P(r)});const e=document.querySelector(".js-event-container");e&&window.innerWidth>1120&&new A(e);const t=document.querySelector(".js-products-slider");t&&new T(t);const i=document.querySelectorAll(".js-set-length-text");i.length&&i.forEach(r=>{new I(r)});const n=document.querySelectorAll(".js-filter-item"),a=document.querySelector(".js-scheme-filter");n.length&&n.forEach(r=>{r.addEventListener("click",()=>p(a,r.getAttribute("data-scheme")))});const o=document.querySelectorAll(".js-listing");o!=null&&o.length&&o.forEach(r=>new _(r))});
